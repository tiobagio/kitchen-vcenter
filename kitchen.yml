---
driver:
  name: vcenter
  vcenter_username: <%= ENV['VCENTER_USER'] %>
  vcenter_password: <%= ENV['VCENTER_PASSWORD'] %>
  vcenter_host:  <%= ENV['VCENTER_HOST'] %>
  datacenter: <%= ENV['VCENTER_DC'] %>
  cluster: <%= ENV['VCENTER_CLUSTER'] %>
  interface: <%= ENV['VCENTER_NETWORK'] %>
  folder: <%= ENV['VCENTER_VMFOLDER'] %>
  vcenter_disable_ssl_verify: true
  clone_type: linked
  customize:
    annotation: "Kitchen VM generated by CICD pipeline"

provisioner:
  name: chef_zero
  sudo_command: sudo
  retry_on_exit_code:
    - 35 # 35 is the exit code signaling that the node is rebooting
  max_retries: 1
  wait_for_retry: 90
  # always_update_cookbooks: true
  client_rb:
    chef_license: accept

verifier:
  name: inspec

platforms:
  - name: RHEL7
    driver:
      template: 'Templates/LabJnk/RHEL7'
    transport:
      username: <%= ENV['KITCHENUSER'] %>
      password: <%= ENV['KITCHENPASS'] %>
  - name: RHEL6
    driver:
      template: 'Templates/LabJnk/RHEL6'
    transport:
      username: <%= ENV['KITCHENUSER'] %>
      password: <%= ENV['KITCHENPASS'] %>
  - name: WIN2008R2
    driver:
      template: 'Templates/LabJnk/WIN2008R2'
    transport:
      username: <%= ENV['KITCHENUSER'] %>
      password: <%= ENV['KITCHENPASS'] %>
  - name: WIN2012R2
    driver:
      template: 'Templates/LabJnk/WIN2012R2'
    transport:
      username: <%= ENV['KITCHENUSER'] %>
      password: <%= ENV['KITCHENPASS'] %>
  - name: WIN2016
    driver:
      template: 'Templates/LabJnk/WIN2016'
    transport:
      username: <%= ENV['KITCHENUSER'] %>
      password: <%= ENV['KITCHENPASS'] %>

suites:
  - name: set1
    verifier:
      inspec_tests:
        - test/integration/rhel
    includes:
     - RHEL6
    lifecycle:
     post_create:
      remote: 'sudo hostname sets-$((100000 + RANDOM % 999990)) ; sudo yum -y install http://sattelitesercer.com/pub/katello-ca-consumer-latest.noarch.rpm ; sudo subscription-manager register --org="ORG" --activationkey="pipeline" --force'
     pre_destroy:
      remote: 'sudo subscription-manager unregister'
  - name: set2
    verifier:
      inspec_tests:
        - test/integration/rhel
    includes:
     - RHEL7
    lifecycle:
     post_create:
      remote: 'sudo hostname sets-$((100000 + RANDOM % 999990)) ; sudo yum -y install http://satellitserver.com/pub/katello-ca-consumer-latest.noarch.rpm ; sudo subscription-manager register --org="AIG" --activationkey="pipeline" --force'
     pre_destroy:
      remote: 'sudo subscription-manager unregister'
  - name: set3
    named_run_list: testmode
    attributes:
      hardening:
        testmode: 1
    provisioner:
      download_url: http://interalrepo.com/chef/chef-infra/15/chef-client-15.4.45-1-x64.msi
    verifier:
      inspec_tests:
        - test/integration/win2008
    includes:
      - WIN2008R2
  - name: set4
    named_run_list: testmode
    attributes:
      hardening:
        testmode: 1
    provisioner:
      download_url: http://interalrepo.com/chef/chef-infra/15/chef-client-15.4.45-1-x64.msi
    verifier:
      inspec_tests:
        - test/integration/win2012
    includes:
      - WIN2012R2
  - name: set5
    named_run_list: testmode
    attributes:
      hardening:
        testmode: 1
    provisioner:
      download_url: http://interalrepo.com/chef/chef-infra/15/chef-client-15.4.45-1-x64.msi
    verifier:
      inspec_tests:
        - test/integration/win2016
    includes:
      - WIN2016
